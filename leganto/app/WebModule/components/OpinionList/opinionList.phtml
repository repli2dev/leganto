{snippet opinion-list}
<div class="opinions list">

    {if !empty($sorting)}
    <table class="navigation">
        <tr>
            <th>Order by:</th>
            <th><a href="{link sortByTime!}" title="{_'Sort by time'}">Time</a></th>
            <th><a href="{link sortByScore!}" title="{_'Sort by score'}">Score</a></th>
        </tr>
    </table>
    {/if}

    @{foreach $opinions AS $opinion}
		<div class="item">
			
			<div class="info-side">
				{if $opinion->content != ""}
					{if $showedInfo == 'user'}
						<img class="icon" src="{$opinion->userId, 50|userico}" />
					{else}
						<img class="icon" src="{$opinion->bookTitleId, 50|bookcover}" />
					{/if}
				{/if}
				<span class="date">{$opinion->inserted|date}</span>

			</div>
			
			<div class="info-top">
				<img class="rating" src="{$baseUri}img/rating_{$opinion->rating}.png" />
				{if $showedInfo == 'user'}
					<a href="{plink User:default, $opinion->userId}">{$opinion->userName|hardTruncate, 20}</a>
				{else}
					<a href="{plink Book:default, $opinion->bookTitleId}">{$opinion->bookTitle}</a>
				{/if}
			</div>

			{if $opinion->content != ""}
				<div class="content">
					{!=$opinion->content|texySafe}
				</div>
			{/if}

			<div class="info-bottom">
				@{if !isset($showedOpinion) || $showedOpinion != $opinion->getId()}
					@{if isset($discussions[$opinion->getId()])}
						<a href="{link showPosts!, $opinion->getId()}" class="control ajax">{_'Show %d comments',$discussions[$opinion->getId()]}</a>
					@{else}
						@{if Environment::getUser()->isAuthenticated()}
							<a href="{link showPosts!, $opinion->getId()}" class="control ajax">{_'Reply'}</a>
						@{/if}
					@{/if}
				@{/if}
			</div>
			<div class="clear"></div>
		</div>
		<div class="opinion-posts">
			@{if isset($showedOpinion) && $showedOpinion == $opinion->getId()}
				@{widget postList}
			@{/if}
		</div>
		<div class="clear"></div>
    @{/foreach}

    {if ($showedPaginator)}
	{widget paginator}
    {/if}
</div>
{/snippet}