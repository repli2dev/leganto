{snippet opinion-list}
<div class="list">

    {if !empty($sorting)}
    <table class="navigation">
        <tr>
            <th>Order by:</th>
            <th><a href="{link sortByTime!}" title="_{'Sort by time}'">Time</a></th>
            <th><a href="{link sortByScore!}" title="_{'Sort by score}'">Score</a></th>
        </tr>
    </table>
    {/if}

    @{foreach $opinions AS $opinion}
    <div class="item">

        {if $showedInfo == 'user'}
            <img class="icon" src="{$opinion->userId, 50|userico}" />
        
            <div class="info">
                <img class="rating" src="{$baseUri}img/rating_{$opinion->rating}.png" />
                {$opinion->inserted|date} | <a href="{plink User:default, $opinion->userId}">{$opinion->userName}</a>
            </div>
        {else}
            <img class="icon" src="{$opinion->bookTitleId, 50|bookcover}" />
            
            <div class="info">
                <img class="rating" src="{$baseUri}img/rating_{$opinion->rating}.png" />
                {$opinion->inserted|date} | <a href="{plink Book:default, $opinion->bookTitleId}">{$opinion->bookTitle}</a>
            </div>
        {/if}

        <div class="content">
            {!=$opinion->content|texy}
        </div>

	<hr style="clear:both; visibility:hidden; margin:0;" />
	
        @{if isset($showedOpinion) && $showedOpinion == $opinion->getId()}
            @{widget postList}
	@{else}
	    @{if isset($discussions[$opinion->getId()])}
		<a href="{link showPosts!, $opinion->getId()}" class="action ajax">{_'Show %d comments',$discussions[$opinion->getId()]}</a>
	    @{else}
		@{if Environment::getUser()->isAuthenticated()}
		    <a href="{link showPosts!, $opinion->getId()}" class="action ajax">{_'Reply'}</a>
		@{/if}
	    @{/if}
	@{/if}

    </div>

    <hr style="clear:both; visibility:hidden;" />
    
    @{/foreach}

    {widget paginator}
</div>
{/snippet}