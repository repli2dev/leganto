<script type="text/javascript">
$(document).ready(function(){

    $(".toggle_container").hide();

    //Switch the "Open" and "Close" state per click then slide up/down (depending on open/close state)
    $(".shelf h2").click(function(){
	$(this).next().slideToggle("slow");
    });


});
</script>

<style>
    html {
	overflow-Y: scroll;
    }
    .shelf {
	margin-left: 20px;
	margin-top: 5px;
    }
    .shelf p {
	margin: 0;
    }
    .shelf ul {
	margin:0;
	padding:0;
    }
    .book-in-shelf {
	display: block;
	padding: 5px;
	margin: 0;
    }
    .book-in-shelf img {
	float: left;
	margin: 0 10px 0 0;
    }
    .book-in-shelf h3 {
	margin: 0;
    }
    .book-in-shelf:hover {
	background: #F9E7A2;
    }
    .shelf h2 {
	cursor: pointer;
	padding: 0 0 0 50px;
	margin: 0 0 5px 0;
	line-height: 2em;
	font-weight: normal;
	background: gray;
    }
</style>

{foreach $shelves AS $shelf}

<div class="shelf">
    <h2>{$shelf->name}</h2>
    <div class="toggle_container">
	{if !empty($books[$shelf->getId()])}
	    {assign link => $component->link('persist', $shelf->getId())}
	    <script>
		$(function() {
			$("#books-in-shelf-{!$shelf->getId()}").sortable({ opacity: 0.6, cursor: 'move', update: function() {
				var order = $(this).sortable("serialize");
				$.post("{!link}", order);
			}
			});
		});
	    </script>
	    <ul class="books-in-shelf" id="books-in-shelf-{$shelf->getId()}">
		{foreach $books[$shelf->getId()] AS $bookRow}
		    {assign book => Leganto::books()->createEmpty()->loadDataFromArray($bookRow->toArray(), "Load")}
		    <li class="book-in-shelf" id="books_{$book->getId()}">
		    <img src="{$book->getId(), 25|bookcover}" width="25" height="40" />
		    <h3>{$book->title}</h3>
		    <hr style="clear:both; visibility:hidden;" />
		</li>
		{/foreach}
	    </ul>
	{/if}
    </div>
</div>
{/foreach}